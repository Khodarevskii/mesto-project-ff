(()=>{"use strict";var e={117:(e,t,n)=>{e.exports=n.p+"6666407ac3aa5af1d5de.jpg"}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var c=t[o]={exports:{}};return e[o](c,c.exports,n),c.exports}n.m=e,n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.p="",n.b=document.baseURI||self.location.href,n.d({},{my:()=>J,I1:()=>N,CV:()=>I,bF:()=>B,Tm:()=>M});var o=function(){return function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}},r={baseUrl:"https://nomoreparties.co/v1/wff-cohort-29",headers:{authorization:"d6cf003f-e9fc-4f07-8135-f8c201818150","Content-Type":"application/json"}},c=function(e,t){return t?fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:r.headers}).then(o()):fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:r.headers}).then(o())},a=document.querySelector("#card-template"),i=function(e){var t;(t=e.target.closest(".card").getAttribute("id"),fetch("".concat(r.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:r.headers}).then(o())).then((function(){e.target.closest(".card").remove()})).catch((function(e){console.log(e)}))};function u(e){var t=e.target.classList.contains("card__like-button_is-active"),n=e.target.closest(".card").getAttribute("id"),o=e.target.closest(".card").querySelector(".card__like-button-counter");c(n,t).then((function(t){console.log(t),e.target.classList.toggle("card__like-button_is-active"),o.textContent=t.likes.length})).catch((function(e){return console.log(e)}))}function s(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",d)}function l(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",d)}n(117);var d=function(e){"Escape"===e.key&&s(document.querySelector(".popup_is-opened"))},p=document.forms["edit-profile"],f=p.elements.name,m=document.querySelector(".profile__title"),_=p.elements.description,v=document.querySelector(".profile__description"),y=document.forms["new-place"],h=y.elements["place-name"],b=y.elements.link,S=document.forms["edit-avatar"],g=S.elements.link;function q(e,t){e.value=t.textContent}function E(e,t){t.textContent=e?"Сохранение...":"Сохранить"}var L={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},k=function(e,t){var n=Array.from(e.querySelectorAll("".concat(t.inputSelector))),o=e.querySelector("".concat(t.submitButtonSelector));n.forEach((function(t){C(e,t)})),A(n,o)},C=function(e,t){var n=e.querySelector(".".concat(t.name,"-error"));t.classList.remove("".concat(L.inputErrorClass)),n.classList.remove("".concat(L.inputErrorClass)),n.textContent=""},x=function(e){var t=Array.from(e.querySelectorAll("".concat(L.inputSelector))),n=e.querySelector("".concat(L.submitButtonSelector));A(t,n),t.forEach((function(o){o.addEventListener("input",(function(){(function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?C(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.name,"-error"));t.classList.add("".concat(L.inputErrorClass)),o.textContent=n,o.classList.add("".concat(L.errorClass))}(e,t,t.validationMessage)})(e,o),A(t,n)}))}))},A=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.removeAttribute("disabled"),t.classList.remove("".concat(L.inactiveButtonClass))):(t.setAttribute("disabled","true"),t.classList.add("".concat(L.inactiveButtonClass)))};new URL(n(117),n.b);var U=document.querySelectorAll(".popup"),w=document.querySelector(".places__list"),P=document.querySelector(".popup_type_image"),T=P.querySelector(".popup__image"),O=P.querySelector(".popup__caption"),j=document.querySelector(".profile__edit-button"),B=document.querySelector(".popup_type_edit"),D=document.querySelector(".profile__add-button"),I=document.querySelector(".popup_type_new-card"),N=document.querySelector(".popup_type_edit-avatar"),J=document.querySelector(".profile__image");function M(e,t,n,o,r,c,s){return w.prepend(function(e,t,n,o,r,c,i,u,s,l){var d=a.content.querySelector(".places__item").cloneNode(!0);d.setAttribute("id","".concat(n));var p=d.querySelector(".card__image"),f=d.querySelector(".card__title"),m=d.querySelector(".card__like-button"),_=d.querySelector(".card__like-button-counter");p.src=t,p.alt=e,_.textContent=c,f.textContent=e;var v=d.querySelector(".card__delete-button");return void 0!==s&&s.forEach((function(e){e._id===o&&m.classList.add("card__like-button_is-active")})),o==r?v.addEventListener("click",i):v.remove(),m.addEventListener("click",u),p.addEventListener("click",(function(){l(e,t)})),d}(e,t,n,o,r,c,i,u,s,V))}function V(e,t){T.setAttribute("src",t),O.textContent=e,l(P)}!function(e){var t=Array.from(document.querySelectorAll("".concat(e.formSelector)));t.forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),t.forEach((function(e){x(e)}))}))}(L),U.forEach((function(e){!function(e){e.addEventListener("click",(function(t){(t.target.classList.contains("popup")||t.target.classList.contains("popup__close"))&&s(e)}))}(e)})),Promise.all([fetch("".concat(r.baseUrl,"/cards"),{headers:r.headers}).then(o()),fetch("".concat(r.baseUrl,"/users/me"),{headers:r.headers}).then(o())]).then((function(e){e[0].forEach((function(t){M(t.name,t.link,t._id,e[1]._id,t.owner._id,t.likes.length,t.likes)})),m.textContent=e[1].name,v.textContent=e[1].about,J.style.backgroundImage="url(".concat(e[1].avatar,")")})).catch((function(e){console.log(e)})),j.addEventListener("click",(function(){l(B),q(f,m),q(_,v),k(B,L)})),D.addEventListener("click",(function(){l(I),k(I,L)})),J.addEventListener("click",(function(){l(N),k(N,L)})),p.addEventListener("submit",(function(e){var t,n;e.preventDefault(),E(!0,B.querySelector(".popup__button")),t=f.value,n=_.value,fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:t,about:n})}).then(o()),then((function(e){m.textContent=e.name,v.textContent=e.about,s(B)})).catch((function(e){console.log(e)})).finally((function(){E(!1,B.querySelector(".popup__button"))}))})),y.addEventListener("submit",(function(e){var t,n;e.preventDefault(),E(!0,I.querySelector(".popup__button")),(t=h.value,n=b.value,fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:t,link:n})}).then(o())).then((function(e){M(e.name,e.link,e._id,e.owner._id,e.owner._id),s(I),y.reset()})).catch((function(e){console.log(e)})).finally((function(){E(!1,I.querySelector(".popup__button"))}))})),S.addEventListener("submit",(function(e){var t;e.preventDefault(),E(!0,N.querySelector(".popup__button")),(t=g.value,fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:t})}).then(o())).then((function(e){J.style.backgroundImage="url(".concat(e.avatar,")"),S.reset(),s(N)})).catch((function(e){console.log(e)})).finally((function(){E(!1,N.querySelector(".popup__button"))}))}))})();